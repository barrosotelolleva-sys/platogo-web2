<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlatoÂ¡GO! - Foto â†’ Plato</title>
  <style>
   @keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
.camera-btn:active { transform: scale(0.95); } 
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #A0DDE6 0%, #B2F7C9 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      text-align: center;
      max-width: 400px;
      width: 100%;
    }
    h1 {
      font-size: clamp(2.5rem, 8vw, 4rem);
      font-weight: 900;
      background: linear-gradient(45deg, #228B22, #39FF14);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    .subtitle {
      font-size: 1.2rem;
      color: #006400;
      margin-bottom: 40px;
    }
    .camera-btn {
      background: linear-gradient(45deg, #228B22, #39FF14);
      color: white;
      border: none;
      padding: 20px 40px;
      font-size: 1.5rem;
      font-weight: 700;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(34,139,34,0.4);
      transition: all 0.3s;
    }
    .camera-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(34,139,34,0.6);
    }
    .preview {
      margin-top: 30px;
      max-width: 100%;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>PlatoÂ¡GO!</h1>
    <p class="subtitle">Foto a la nevera â†’ Â¡Plato ya!</p>
    
    <button class="camera-btn" onclick="openCamera()">
      TOMAR FOTO
    </button>
    
    <img id="preview" class="preview" style="display:none;">
  </div>

<script>
  let stream;
  const API_KEY = 'AIzaSyDLtNNmcZnD8pymaAZqWA6wGjrMzhlVTpA'; // â† TU CLAVE
  const SPOONACULAR_KEY = 'fb1bcb51f67e4c7d8d709f610c3254d1'; // â† TU CLAVE

  const FOOD_KEYWORDS = [
    'bottle', 'botella', 'wine', 'vino', 'jar', 'frasco', 'package', 'envase', 
    'carton', 'brik', 'milk carton', 'brik de leche', 'juice', 'zumo', 'can', 'lata',
    'box', 'caja', 'bag', 'bolsa', 'container', 'recipiente',
    'pascual', 'asturiana', 'central lechera', 'danone', 'nestle', 'kaiku', 
    'president', 'la lechera', 'el pozo', 'campofrÃ­o', 'oscar mayer', 
    'heinz', 'hellmanns', 'mahou', 'estrella galicia', 'san miguel',
    'milk', 'leche', 'yogurt', 'yogur', 'cheese', 'queso', 'butter', 'mantequilla',
    'cream', 'nata', 'yoghurt', 'yogourt',
    'tomato', 'tomate', 'pepper', 'pimiento', 'bell pepper', 'apple', 'manzana',
    'banana', 'plÃ¡tano', 'orange', 'naranja', 'lemon', 'limÃ³n', 'grape', 'uva',
    'strawberry', 'fresa', 'kiwi', 'melon', 'sandÃ­a', 'watermelon', 'pineapple', 'piÃ±a',
    'onion', 'cebolla', 'garlic', 'ajo', 'potato', 'patata', 'carrot', 'zanahoria',
    'lettuce', 'lechuga', 'cucumber', 'pepino', 'avocado', 'aguacate', 'broccoli', 'brÃ³coli',
    'spinach', 'espinacas', 'zucchini', 'calabacÃ­n',
    'chicken', 'pollo', 'beef', 'carne', 'pork', 'cerdo', 'ham', 'jamÃ³n',
    'sausage', 'salchicha', 'meat', 'fish', 'pescado', 'salmon', 'salmÃ³n',
    'tuna', 'atÃºn', 'cod', 'bacalao',
    'rice', 'arroz', 'pasta', 'macarrones', 'spaghetti', 'bread', 'pan',
    'oil', 'aceite', 'olive oil', 'aceite de oliva', 'flour', 'harina',
    'sugar', 'azÃºcar', 'salt', 'sal', 'beans', 'alubias', 'lentils', 'lentejas',
    'chickpea', 'garbanzo', 'jam', 'mermelada', 'honey', 'miel',
    'sauce', 'salsa', 'ketchup', 'mayonnaise', 'mayonesa', 'mustard', 'mostaza',
    'vinegar', 'vinagre', 'soy sauce', 'salsa de soja'
  ];

  // TRADUCCIÃ“N FINAL AL ESPAÃ‘OL
  const TRANSLATE = {
    'bottle': 'botella', 'wine': 'vino', 'jar': 'frasco', 'package': 'envase',
    'carton': 'brik', 'milk carton': 'brik de leche', 'juice': 'zumo',
    'milk': 'leche', 'yogurt': 'yogur', 'cheese': 'queso', 'butter': 'mantequilla',
    'tomato': 'tomate', 'pepper': 'pimiento', 'bell pepper': 'pimiento',
    'apple': 'manzana', 'banana': 'plÃ¡tano', 'orange': 'naranja', 'lemon': 'limÃ³n',
    'chicken': 'pollo', 'beef': 'carne', 'pork': 'cerdo', 'ham': 'jamÃ³n',
    'sausage': 'salchicha', 'meat': 'carne', 'fish': 'pescado',
    'rice': 'arroz', 'pasta': 'pasta', 'bread': 'pan', 'oil': 'aceite',
    'jam': 'mermelada', 'sauce': 'salsa', 'ketchup': 'ketchup', 'mayonnaise': 'mayonesa'
  };

  async function openCamera() {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      const video = document.createElement('video');
      video.srcObject = stream;
      video.play();

      setTimeout(async () => {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth || 640;
        canvas.height = video.videoHeight || 480;
        canvas.getContext('2d').drawImage(video, 0, 0);

        const img = document.getElementById('preview');
        img.src = canvas.toDataURL('image/jpeg');
        img.style.display = 'block';
        stream.getTracks().forEach(track => track.stop());

        const loading = document.createElement('p');
        loading.id = 'loading';
        loading.innerHTML = 'Analizando...';
        loading.style.color = '#228B22';
        loading.style.marginTop = '20px';
        document.querySelector('.container').appendChild(loading);

        const base64 = canvas.toDataURL('image/jpeg').split(',')[1];

        try {
          const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              requests: [{
                image: { content: base64 },
                features: [{ type: 'LABEL_DETECTION', maxResults: 100 }]
              }]
            })
          });

          const data = await response.json();
          const labels = (data.responses[0]?.labelAnnotations || [])
            .filter(l => l.score > 0.45) // CONFIDENCIA BAJA
            .map(l => l.description.toLowerCase());

          // FILTRA POR PALABRAS CLAVE
          const detected = [...new Set(
            labels.filter(word => FOOD_KEYWORDS.includes(word))
          )];

          // TRADUCE AL ESPAÃ‘OL
          const detectedSpanish = detected.map(word => TRANSLATE[word] || word);

          document.getElementById('loading').remove();

          if (detectedSpanish.length > 0) {
            const result = document.createElement('div');
            result.innerHTML = `
              <p style="margin-top:20px; font-weight:700; color:#228B22; animation: pulse 1s;">
                DetectÃ©: <strong>${detectedSpanish.join(', ')}</strong>
              </p>
            `;
            document.querySelector('.container').appendChild(result);

            const recipeBtn = document.createElement('button');
            recipeBtn.className = 'camera-btn';
            recipeBtn.style.marginTop = '20px';
            recipeBtn.style.background = 'linear-gradient(45deg, #FF4500, #FF8C00)';
            recipeBtn.innerHTML = 'SUGERIR PLATO';
            recipeBtn.onclick = () => suggestRecipe(detectedSpanish);
            document.querySelector('.container').appendChild(recipeBtn);

          } else {
            const result = document.createElement('div');
            result.innerHTML = `
              <p style="margin-top:20px; color:#DAA520;">
                No detectÃ© alimentos ðŸ˜…<br>
                <small>Prueba con mÃ¡s luz o enfoca mejor</small>
              </p>
            `;
            document.querySelector('.container').appendChild(result);
          }

        } catch (err) {
          document.getElementById('loading').remove();
          alert('Error: revisa tu clave de Google Vision');
        }

      }, 3000);

    } catch (err) {
      alert('CÃ¡mara no disponible');
    }
  }

  // RECETA (igual)
  async function suggestRecipe(ingredientsES) {
    const query = ingredientsES.join(',');
    const loading = document.createElement('p');
    loading.id = 'recipe-loading';
    loading.innerHTML = 'Buscando receta...';
    loading.style.color = '#FF4500';
    document.querySelector('.container').appendChild(loading);

    try {
      const response = await fetch(`https://api.spoonacular.com/recipes/findByIngredients?ingredients=${query}&number=1&apiKey=${SPOONACULAR_KEY}&language=es`);
      const recipes = await response.json();
      document.getElementById('recipe-loading').remove();

      if (recipes.length > 0) {
        const r = recipes[0];
        const missed = r.missedIngredients.map(i => i.name).join(', ') || 'ninguno';
        const recipeDiv = document.createElement('div');
        recipeDiv.style.marginTop = '20px';
        recipeDiv.style.padding = '15px';
        recipeDiv.style.background = '#fff';
        recipeDiv.style.borderRadius = '15px';
        recipeDiv.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
        recipeDiv.innerHTML = `
          <h3 style="color:#FF4500; margin-bottom:10px;">${r.title}</h3>
          <p><strong>Tiempo:</strong> ${r.readyInMinutes} min</p>
          <p><strong>Faltan:</strong> ${missed}</p>
        `;
        document.querySelector('.container').appendChild(recipeDiv);
      } else {
        alert('No encontrÃ© receta');
      }
    } catch (err) {
      document.getElementById('recipe-loading')?.remove();
      alert('Error al buscar receta');
    }
  }
</script>
</body>
</html>